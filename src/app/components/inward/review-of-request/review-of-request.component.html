<div class="border rounded p-3 mb-2 position-relative">
  <legend
    class="w-auto px-2 fw-semibold theme-color"
    style="font-size: 1rem; position: absolute; top: -0.9em; left: 1em; background: white"
  >
    Plan Details
  </legend>

  <!-- THIRD SECTION: SAMPLE-WISE MULTI-TAB TEST PLAN -->
  <div formArrayName="sampleTestPlans" class="mt-3">
    <div
      *ngFor="let sampleGroup of sampleTestPlans.controls; let i = index"
      [formGroupName]="i"
      class="mb-3 border rounded p-3 position-relative"
    >
      <legend
        class="w-auto px-2 fw-semibold theme-color"
        style="font-size: 1rem; position: absolute; top: -0.9em; left: 1em; background: white"
      >
        Sample No: {{ sampleGroup.get('sampleNo')?.value }}
      </legend>

      <!-- Sample Details Card -->
      <div *ngIf="sampleDetails.length > 0" class="card border shadow-sm mb-3">
        <div class="card-body small">
          <div class="row row-cols-1 row-cols-md-auto g-3">
            <div>
              <!-- Add sample details fields if needed -->
            </div>
            <div>
            </div>
            <div>
            </div>
            <div>
            </div>
            <ng-container *ngFor="let row of sampleAdditionalDetails.controls; let j = index">
              <!-- Add additional details if needed -->
            </ng-container>
            <!-- Sample Prepration Required -->
            <div>
            </div>
          </div>
        </div>
      </div>
      
      <ul class="nav nav-tabs mb-3" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="general-tab-{{ i }}"
            [attr.data-bs-toggle]="'tab'"
            [attr.data-bs-target]="'#general-' + i"
            type="button"
            role="tab"
          >
            General Test
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="chemical-tab-{{ i }}"
            [attr.data-bs-toggle]="'tab'"
            [attr.data-bs-target]="'#chemical-' + i"
            type="button"
            role="tab"
          >
            Chemical Test
          </button>
        </li>
      </ul>

      <div class="tab-content">
        <!-- General Test -->
        <div class="tab-pane fade show active" id="general-{{ i }}" role="tabpanel">
          <ng-container *ngIf="getMethodRows(i).length > 0">
            <div [formGroup]="getGeneralTestSection(i)">
              <!-- Add general test fields here -->
            </div>
          </ng-container>
        </div>

        <!-- Chemical Test Tab -->
        <div class="tab-pane fade" id="chemical-{{ i }}" role="tabpanel">
          <div formArrayName="chemicalTests">
            <ng-container *ngIf="getTestArray(i, 'chemicalTests').length > 0">
              <!-- Add chemical test fields here -->
            </ng-container>

            <button type="button" class="btn btn-sm btn-outline-danger-600" (click)="addTestBlock(i, 'chemicalTests')">
              Add Chemical Test
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
